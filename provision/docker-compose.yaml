version: '3'
services:
  golr:
    hostname: golr 
    container_name: golr 
    image: amigo:{{ tag }}
    environment:
      - GOLR=1
      - AMIGO=0
    volumes:
      - {{ repo_dir }}:/srv/amigo
      - {{ stage_dir }}/srv-solr-data:/srv/solr/data
      - {{ stage_dir }}/amigo.yaml:/srv/amigo/conf/amigo.yaml
    restart: unless-stopped

  amigo:
    hostname: amigo
    container_name: amigo
    image: amigo:{{ tag }}
    environment:
      - GOLR=0
      - AMIGO=1
    volumes:
      - {{ repo_dir }}:/srv/amigo
      - {{ stage_dir }}/srv-solr-data:/srv/solr/data
      - {{ stage_dir }}/amigo.yaml:/srv/amigo/conf/amigo.yaml
      - {{ stage_dir }}/001-inline-amigo.conf:/etc/apache2/sites-available/001-inline-amigo.conf
      - {{ stage_dir }}/apache2.ports.conf:/etc/apache2/ports.conf
      - {{ stage_dir }}/apache_amigo_logs:/var/log/apache2
    restart: unless-stopped
    depends_on:
      - golr 

  apache_amigo:
    hostname: apache_amigo
    container_name: apache_amigo
    image: httpd:2.4.51
    restart: unless-stopped
    volumes:
      - {{ stage_dir }}//httpd.conf:/usr/local/apache2/conf/httpd.conf
      - {{ stage_dir }}/httpd-vhosts-amigo.conf:/usr/local/apache2/conf/extra/httpd-vhosts-amigo.conf
      - {{ stage_dir }}/httpd-vhosts-golr.conf:/usr/local/apache2/conf/extra/httpd-vhosts-golr.conf
      - {{ stage_dir }}/apache_proxy_logs:/usr/local/apache2/logs
    ports:
      - "80:80"
    depends_on:
      - golr 
      - amigo
